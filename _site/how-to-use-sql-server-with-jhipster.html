<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>How to use SQL Server with jHipster</title>
  <meta name="description" content="Goal: By the end of this tutorial you will have the default JHipster application running on your SQL Server, with everything being functional.">
  <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:600' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://blog.erick-romero.com/how-to-use-sql-server-with-jhipster">
  <link rel="alternate" type="application/rss+xml" title="My Blog" href="http://blog.erick-romero.com/feed.xml" />
  <link rel="icon" type="image/x-icon" href="assets/images/favicon.ico" />
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="http://blog.erick-romero.com/">My Blog</a>

    <nav class="site-nav">
        
          
          <a class="page-link" href="http://blog.erick-romero.com/about/">About</a>
          
        
          
        
          
        
          
        
    </nav>

  </div>

</header>


    <div class="page-content">
        <div class="post">

  <header class="post-header">
    <h1 class="post-title">How to use SQL Server with jHipster</h1>
    <p class="post-meta">Jun 13, 2015</p>
  </header>

  <article class="post-content">
    <p><em>Goal:</em> By the end of this tutorial you will have the default JHipster application running on your SQL Server, with everything being functional.</p>

<p>Start by running JHipster normally with <code>yo jhipster</code>, select the options to use Java 8, token based authentication, SQL, MySQL as the dev. database, MySQL as the prod. database, Yes with ehcache, No Elasticsearch, No clustered HTTP, No Websockets, Maven, Grunt, and no Compass.</p>

<p>We then add the MS SQL Server JDBC dependency to the project <code>pom.xml</code> file.</p>

<p><em>pom.xml</em></p>

<pre><code>[...]
&lt;!-- Microsoft JDBC --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.microsoft.sqlserver&lt;/groupId&gt;
    &lt;artifactId&gt;sqljdbc41&lt;/artifactId&gt;
    &lt;version&gt;4.1&lt;/version&gt;
&lt;/dependency&gt;
&lt;!-- Liquibase MS SQL Server extensions --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.github.sabomichal&lt;/groupId&gt;
    &lt;artifactId&gt;liquibase-mssql&lt;/artifactId&gt;
    &lt;version&gt;1.4&lt;/version&gt;
&lt;/dependency&gt;
[...]
</code></pre>

<p>I am using Sql JDBC 4.1, and already have it installed to my personal repository, but if you do not this will not work without some further configuration, check out <a href="https://stackoverflow.com/questions/30207842/add-external-library-jar-to-spring-boot-jar-internal-lib">this</a> stackoverflow question for further reference.</p>

<p>The Liquibase MS SQL Server extension allows you to do some neat stuff we will be using later on in this tutorial.</p>

<h2 id="database-modification">Database modification</h2>

<p>Go into <code>src\main\resources\config\application-dev.yml</code> and change your application to use the new datasource, and your Hibernate configuration to use the SQL Server dialect as seen below:</p>

<p><em>application-dev.yml</em></p>

<pre><code>spring:
    profiles:
        active: dev
    datasource:
        driverClassName: com.microsoft.sqlserver.jdbc.SQLServerDriver
        dataSourceClassName: com.microsoft.sqlserver.jdbc.SQLServerDataSource
        url: jdbc:sqlserver://localhost:1433;databaseName=test
        databaseName:
        serverName:
        username: myuser
        password: supersecretpassword
        cachePrepStmts: true
        prepStmtCacheSize: 250
        prepStmtCacheSqlLimit: 2048
        useServerPrepStmts: true

    jpa:
        database-platform: org.hibernate.dialect.SQLServerDialect
        database: SQL_SERVER
        openInView: false
        show_sql: true
        generate-ddl: false
        [...]
</code></pre>

<p>This assuming your database is called <code>test</code>, change your connection url as necessary.</p>

<p>Now go into <code>*\src\main\resources\config\liquibase\changelog\00000000000000_initial_schema.xml</code> and at the top of the file change the following properties:</p>

<p><em>00000000000000_initial_schema.xml</em></p>

<pre><code>&lt;databaseChangeLog
    xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd
    http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd"&gt;

    &lt;property name="now" value="now()" dbms="mysql,h2"/&gt;
    &lt;property name="now" value="current_timestamp" dbms="postgresql"/&gt;
    &lt;property name="now" value="GETDATE()" dbms="mssql"/&gt;

    &lt;changeSet id="00000000000000" author="jhipster" dbms="postgresql"&gt;
        &lt;createSequence sequenceName="hibernate_sequence" startValue="1000" incrementBy="1"/&gt;
    &lt;/changeSet&gt;
    [...]
</code></pre>

<p>First, make sure you changed your xml databaseChangeLog property to include the ext. Now inside <code>src\main\resources\config\liquibase\changelog\00000000000000_initial_schema.xml</code> find the data entries and change them:</p>

<p><em>00000000000000_initial_schema.xml</em></p>

<pre><code>&lt;ext:loadData encoding="UTF-8"
          file="config/liquibase/users.csv"
          separator=";"
          tableName="JHI_USER" identityInsertEnabled="true"&gt;
    &lt;column name="activated" type="boolean"/&gt;
    &lt;column name="created_date" type="timestamp"/&gt;
&lt;/ext:loadData&gt;
&lt;dropDefaultValue tableName="JHI_USER" columnName="created_date" columnDataType="datetime"/&gt;

&lt;ext:loadData encoding="UTF-8"
              file="config/liquibase/authorities.csv"
              separator=";"
              tableName="JHI_AUTHORITY"
              identityInsertEnabled="true" /&gt;

&lt;ext:loadData encoding="UTF-8"
              file="config/liquibase/users_authorities.csv"
              separator=";"
              tableName="JHI_USER_AUTHORITY"
              identityInsertEnabled="true" /&gt;
</code></pre>

<p>Adding the <code>identityInsertEnabled="true"</code> is the same as wrapping your Inserts with <code>IDENTITY_INSERT ON</code> and <code>IDENTITY_INSERT OFF</code> which will allow you to insert the project autogenerated identities directly. This is why we are using the MS SQL Server Liquibase for.</p>

<p>Now try running your application! Everything should be working and you should be on your way to continue using your JHipster application with SQL Server.</p>

<p><em>Originally submitted this to the <a href="https://jhipster.github.io/tips/004_tip_using_ms_sql_server.html">jHipster Tips Section</a></em></p>


  </article>

</div>

    </div>

  </body>

</html>
